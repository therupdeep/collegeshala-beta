<!DOCTYPE html>
<html lang="en">

<head>
  <script src="js/aws/aws-cognito-sdk.min.js"></script>
  <script src="js/aws/amazon-cognito-identity.min.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/auth.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-163674715-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "UA-163674715-1");
  </script>

  <!-- Required meta tags -->
  <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1" />
  <meta content="width=device-width; initial-scale=1.0; maximum-scale=1.0;   user-scalable=0;" name="viewport" />

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous" />

  <link rel="stylesheet" href="./css/style.css" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
    integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <title>College Shala</title>
  <link rel="icon" href="./assets/images/collegeshala-logo-svg.svg" />
</head>

<body onload="getUploads()">
  <nav class="navbar custom-nav navbar-expand-lg navbar-light bg-custom-blur">
    <a class="navbar-brand" href="/">
      <img src="./assets/images/logo.png" id="logo" alt="" />
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText"
      aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarText">
      <ul class="navbar-nav mx-auto">
        <li class="nav-item">
          <p class="nav-seach-box">
            <input type="text" placeholder="Search your subject here " />
          </p>
        </li>
      </ul>
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link navbar-talkshala" href="./coming-soon.html">
            TalkShala
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="./cart.html">
            <i class="fa fa-shopping-cart" aria-hidden="true"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="./teacher-account.html">
            <i class="fa fa-user-circle" aria-hidden="true"></i>
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <div class="container pt-4">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Home</a></li>
        <li class="breadcrumb-item"><a href="#">Teacher's Name</a></li>
        <li class="breadcrumb-item active" aria-current="page">
          Teacher's Dashboard
        </li>
      </ol>
    </nav>
  </div>

  <div class="container student-dash-nav">
    <div class="row">
      <div class="col-sm text-center">
        <a class="active" href="./teacher-account.html">My Account</a>
      </div>
      <div class="col-sm text-center">
        <a href="./my-uploads.html">My Uploads</a>
      </div>
      <div class="col-sm text-center">
        <a href="./my-earnings.html">My Earnings</a>
      </div>
      <div class="col-sm text-center">
        <a href="./coming-soon.html">Q/A Forum</a>
      </div>
    </div>
  </div>

  <div class="container">
    <hr />
  </div>

  <!-- Teacher Upload Button Open div -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- Nav tabs -->
          <ul class="nav nav-tabs">
            <li class="nav-item">
              <a class="nav-link active" data-toggle="tab" href="#teacher-upload-notes-tab">Upload Notes</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#teacher-upload-sample-paper-tab">Upload Sample Paper</a>
            </li>
          </ul>

          <!-- Tab panes -->
          <div class="tab-content">
            <div id="teacher-upload-notes-tab" class="container tab-pane active">
              <br />
              <h3>Upload Notes</h3>
              <form>
                <div class="form-group">
                  <input type="file" name="file" id="file" class="inputfile" />
                </div>
                <div class="form-group">
                  <label for="teacher-upload-subject-name">Subject Name</label>
                  <input type="text" class="form-control" id="teacher-upload-subject-name" aria-describedby="emailHelp"
                    placeholder="Enter subject name" />
                </div>
                <div class="form-group">
                  <label for="teacher-upload-chapter-name">Chapter Name</label>
                  <input type="text" class="form-control" id="teacher-upload-chapter-name" aria-describedby="emailHelp"
                    placeholder="Enter chapter name" />
                </div>
                <div class="form-group">
                  <label for="teacher-upload-semester-number">For which semester?</label>
                  <input type="text" class="form-control" id="teacher-upload-semester-number"
                    aria-describedby="emailHelp" placeholder="Enter semester" />
                </div>
                <div class="form-group">
                  <label for="teacher-upload-university-name">University Name</label>
                  <input type="text" class="form-control" id="teacher-upload-university-name"
                    aria-describedby="emailHelp" placeholder="Enter University name" />
                </div>
                <button onclick="handleUpload()" id="submi-notes-upload" class="btn btn-primary">
                  Submit
                </button>
              </form>
            </div>
            <div id="teacher-upload-sample-paper-tab" class="container tab-pane fade">
              <br />
              <h3>Upload Sample Paper</h3>
              <form>
                <div class="form-group">
                  <input type="file" name="file" id="sample-paper-file" class="inputfile" />
                </div>
                <div class="form-group">
                  <label for="teacher-upload-sample-paper-subject-name">Subject Name</label>
                  <input type="email" class="form-control" id="teacher-upload-sample-paper-subject-name"
                    aria-describedby="emailHelp" placeholder="Enter subject name" />
                </div>
                <div class="form-group">
                  <label for="teacher-upload-sample-paper-semester-number">For which semester?</label>
                  <input type="email" class="form-control" id="teacher-upload-sample-paper-semester-number"
                    aria-describedby="emailHelp" placeholder="Enter semester" />
                </div>
                <div class="form-group">
                  <label for="teacher-upload-sample-paper-university-name">University Name</label>
                  <input type="email" class="form-control" id="teacher-upload-sample-paper-university-name"
                    aria-describedby="emailHelp" placeholder="Enter University name" />
                </div>
                <button type="submit" id="submi-sample-paper-upload" class="btn btn-primary">
                  Submit
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- display if notes uploaded successfully-->
  <div role="alert" aria-live="assertive" aria-atomic="true" class="toast" data-autohide="false">
    <div class="toast-header">
      <img src="..." class="rounded mr-2" alt="..." />
      <strong class="mr-auto">Bootstrap</strong>
      <small>11 mins ago</small>
      <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="toast-body">
      Hello, world! This is a toast message.
    </div>
  </div>

  <div class="container mt-5">
    <div class="row">
      <div class="col-md-8">
        <h1 class="teacher-dashboard-main-heading">
          Want to Upload a new note?
        </h1>
      </div>
      <div class="col-6 col-md-4">
        <!-- Button trigger modal -->
        <button type="button" class="btn mt-2" id="teacher-upload-button" data-toggle="modal"
          data-target="#exampleModal">
          Upload Now &#8594;
        </button>
      </div>
    </div>
  </div>

  <h3 class="container mt-5">
    Previously Updated Notes
  </h3>

  <div class="container student-dashboard-material mt-3">
    <div id="myuploadsrow" class="row">


    </div>
    <nav aria-label="Page navigation example" class="text-center pt-4">
      <ul class="pagination justify-content-center">
        <li class="page-item">
          <a class="page-link" href="#" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
            <span class="sr-only">Previous</span>
          </a>
        </li>
        <li class="page-item"><a class="page-link" href="#">1</a></li>
        <li class="page-item"><a class="page-link" href="#">2</a></li>
        <li class="page-item"><a class="page-link" href="#">3</a></li>
        <li class="page-item">
          <a class="page-link" href="#" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
            <span class="sr-only">Next</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Site footer -->
  <footer class="site-footer">
    <div class="container">
      <div class="row">
        <div class="col-12 col-md-6">
          <!--<h6>About the company</h6> -->
          <a href="./about.html">
            <h6 class="text-justify">
              About Us
            </h6>
          </a>
          <div class="row">
            <div class="col-12 col-md-4">
              <a target="_blank" href="./copyright.html">Copyright</a><br />
              <a target="_blank" href="./disclaimer-warranties.html">Disclaimer Warranties</a><br />
              <a target="_blank" href="./privacy-policy.html">Privacy Policy</a>
            </div>
            <div class="col-12 col-md-4">
              <a target="_blank" href="./return-policy.html">Return Policy</a><br />
              <a target="_blank" href="./professor-info.html">Course Advisors</a><br />
              <a target="_blank" href="./terms-of-use.html">Terms of Use</a>
            </div>
          </div>
        </div>
        <!--
        <div class="col-xs-6 col-md-3">
          <h6>Important Links</h6>
          <ul class="footer-links">
            <li>
              <a href="">lorem Ipsum</a>
            </li>
            <li>
              <a href="">lorem Ipsum</a>
            </li>
            <li>
              <a href="">lorem Ipsum</a>
            </li>
            <li>
              <a href="http://scanfcode.com/category/java-programming-language/">Lorem Ispum</a>
            </li>
          </ul>
        </div>
        -->
        <div class="col-xs-6 col-md-4">
          <h6>Connect With Us</h6>
          <ul class="footer-links">
            <li>
              <a target="_blank" href=""><img src="./assets/images/footer/twitter-icon.png" id="footer-social-icons"
                  alt="" srcset="" /></a>
              <a target="_blank" href="mailto:collegeshala2020@gmail.com"><img
                  src="./assets/images/footer/gmailicon.png" id="footer-social-icons" alt="" srcset="" /></a>
              <a target="_blank" href="https://www.facebook.com/CollegeShalareal/"><img
                  src="./assets/images/footer/facebook-icon.png" id="footer-social-icons" alt="" rcset="" /></a>
              <a target="_blank" href="https://www.linkedin.com/company/collegeshala-edutech/"><img
                  src="./assets/images/footer/linkedin-icon.png" id="footer-social-icons" alt="" rcset="" /></a>
            </li>
            <li>
              <a target="_blank"
                href="https://www.google.com/maps/dir//offbeats+ccu/data=!4m6!4m5!1m1!4e2!1m2!1m1!1s0x3a02772f380eb913:0xbc0dddd2e9b59b53?sa=X&ved=2ahUKEwj14s2a3I_pAhUGwzgGHW2kAe0Q9RcwDXoECB0QDg">Office:
                405, OFFBEAT CCU, 36/F, Topsia Rd, Topsia, Kolkata,
                West Bengal 700039</a>
            </li>
            <li>
              <a href="#">Call US: 8583994561, 9230429404</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="copyright-area">
      <p class="text-center" id="footer-copyright-text">
        <i class="far fa-copyright"></i> 2020 CollegeShala | All Rights
        Reserved
      </p>
    </div>
  </footer>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>
  <script src="./js/scroll.js"></script>

  <script src="/js/auth.js"></script>
  <script src="/js/upload.js"></script>
  <script src="/js/aws/aws-sdk-2.663.0.min.js"></script>
  <script src="/js/aws/config.js"></script>
  <script>

    let state = {
      counter: 0
    }

    async function handleUpload() {
      event.preventDefault();

      let token = await userAuth.authToken;

      function getCredentials() {
        return new Promise(function (resolve, reject) {
          $.ajax({
            method: 'POST',
            url: "https://api.collegeshala.com/getkey",
            headers: {
              authorization: token,
            },
            data: JSON.stringify({}),
            contentType: 'application/json',
            success: function complete(result) {
              resolve(result);
            },
            error: function error(err) {
              reject(err);
            }
          });
        })
      }
      let config = await getCredentials();
      // console.log(config);

      AWS.config.update({
        accessKeyId: config.accessKeyId,
        secretAccessKey: config.secretAccessKey,
        region: 'ap-south-1',
      });
      config = {};
      notes = document.getElementById('file');
      // console.log(notes, "here3")
      var file = notes.files[0];
      // console.log(file, "here2");
      console.log(authToken);
      var chaptername = document.getElementById('teacher-upload-chapter-name').value;  // add chapter name here
      var subjectname = document.getElementById('teacher-upload-subject-name').value; // add subject name here
      var universityname = document.getElementById('teacher-upload-university-name').value;  // add universityname here
      var sem = document.getElementById('teacher-upload-semester-number').value; // add sem here
      uploadNotes(file, token, chaptername, subjectname, universityname, sem)
    }

    let authToken;
    userAuth.authToken.then(function setAuthToken(token) {
      if (token) {
        authToken = token;
        // console.log(authToken, "herein")

        if (!authToken) {
          console.log("User not signed in!");
        } else {
          $.ajax({
            method: 'POST',
            url: "https://api.collegeshala.com/professordetails",
            headers: {
              authorization: authToken
            },
            data: {},
            contentType: 'application/json',
            success: function complete(result) {
              console.log(result);
              // setData(result);
            },
            error: function error(err) {
              console.error(err);
            }
          });
        }
      } else {
        window.location.href = '/login.html';
      }
    }).catch(function handleTokenError(error) {
      alert(error);
      window.location.href = '/login.html';
    });

    function viewNote() {
      $(".btn-primary").click(function () {
        event.preventDefault();
        // console.log(state.counter);
        //console.log(event.target.value)
        localStorage.setItem("noteId", event.target.value);
        // state.counter++;
        window.open(window.location.origin + "/pdf_full.html", "_blank");
      })
    }

    async function getUploads() {

      let token = await userAuth.authToken;

      function fetchUploads() {
        return new Promise(function (resolve, reject) {
          $.ajax({
            method: 'POST',
            url: "https://api.collegeshala.com/professordetails",
            headers: {
              authorization: token,
            },
            // data: JSON.stringify({}),
            contentType: 'application/json',
            success: function complete(result) {
              resolve(result);
            },
            error: function error(err) {
              reject(err)
            }
          });
        })
      }

      const prof = (await fetchUploads()).Item;
      const uploads = prof.myUploads;

      setData(uploads);
    }

    function setData(uploads = []) {
      $.each(uploads, function(index, note) {
        $('#myuploadsrow').append(
          `<div class="col-12 col-md-4" key="${note.noteId}">
              <div class="card">
                <img class="card-img-top img-fluid" src="https://via.placeholder.com/260x180" alt="Card image cap" />
                <div class="card-body">
                  <h5 class="card-title">${note.subjectname}</h5>
                  <p class="card-text">
                    ${note.chaptername}
                  </p>
                  <button onclick="viewNote()" class="btn btn-primary" value="${note.noteId}">Read</button>
                </div>
              </div>
            </div>`
        );
      })
    }
  </script>
</body>

</html>